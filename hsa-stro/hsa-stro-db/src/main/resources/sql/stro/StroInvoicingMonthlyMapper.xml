<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hsa.module.stro.stroinvoicing.dao.StroInvoicingMonthlyDAO">
  <resultMap id="BaseResultMap" type="cn.hsa.module.stro.stroinvoicing.entity.StroInvoicingMonthlyDO">
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="hosp_code" jdbcType="VARCHAR" property="hospCode" />
    <result column="biz_id" jdbcType="VARCHAR" property="bizId" />
    <result column="item_code" jdbcType="VARCHAR" property="itemCode" />
    <result column="item_id" jdbcType="VARCHAR" property="itemId" />
    <result column="item_name" jdbcType="VARCHAR" property="itemName" />
    <result column="num" jdbcType="DECIMAL" property="num" />
    <result column="unit_code" jdbcType="VARCHAR" property="unitCode" />
    <result column="curr_unit_code" jdbcType="VARCHAR" property="currUnitCode" />
    <result column="sell_price" jdbcType="DECIMAL" property="sellPrice" />
    <result column="buy_price" jdbcType="DECIMAL" property="buyPrice" />
    <result column="split_ratio" jdbcType="DECIMAL" property="splitRatio" />
    <result column="split_price" jdbcType="DECIMAL" property="splitPrice" />
    <result column="split_num" jdbcType="DECIMAL" property="splitNum" />
    <result column="split_unit_code" jdbcType="VARCHAR" property="splitUnitCode" />
    <result column="up_surplus_num" jdbcType="DECIMAL" property="upSurplusNum" />
    <result column="surplus_num" jdbcType="DECIMAL" property="surplusNum" />
    <result column="up_buy_price_all" jdbcType="DECIMAL" property="upBuyPriceAll" />
    <result column="buy_price_all" jdbcType="DECIMAL" property="buyPriceAll" />
    <result column="up_sell_price_all" jdbcType="DECIMAL" property="upSellPriceAll" />
    <result column="sell_price_all" jdbcType="DECIMAL" property="sellPriceAll" />
    <result column="crte_time" jdbcType="TIMESTAMP" property="crteTime" />
    <result column="new_price" jdbcType="DECIMAL" property="newPrice" />
    <result column="new_split_price" jdbcType="DECIMAL" property="newSplitPrice" />
    <result column="stro_in_num" jdbcType="DECIMAL" property="stroInNum" />
    <result column="stro_in_num_price_all" jdbcType="DECIMAL" property="stroInNumPriceAll" />
    <result column="return_supl_num" jdbcType="DECIMAL" property="returnSuplNum" />
    <result column="return_supl_price_all" jdbcType="DECIMAL" property="returnSuplPriceAll" />
    <result column="stro_to_dept_num" jdbcType="DECIMAL" property="stroToDeptNum" />
    <result column="stro_to_dept_price_all" jdbcType="DECIMAL" property="stroToDeptPriceAll" />
    <result column="stro_to_phar_num" jdbcType="DECIMAL" property="stroToPharNum" />
    <result column="stro_to_phar_price_all" jdbcType="DECIMAL" property="stroToPharPriceAll" />
    <result column="report_losses_num" jdbcType="DECIMAL" property="reportLossesNum" />
    <result column="report_losses_price_all" jdbcType="DECIMAL" property="reportLossesPriceAll" />
    <result column="phar_return_stro_num" jdbcType="DECIMAL" property="pharReturnStroNum" />
    <result column="phar_return_stro_price_all" jdbcType="DECIMAL" property="pharReturnStroPriceAll" />
    <result column="adjust_profit_price_all" jdbcType="DECIMAL" property="adjustProfitPriceAll" />
    <result column="adjust_loss_price_all" jdbcType="DECIMAL" property="adjustLossPriceAll" />
    <result column="take_strock_subtract_num" jdbcType="DECIMAL" property="takeStrockSubtractNum" />
    <result column="take_strock_subtract_price_all" jdbcType="DECIMAL" property="takeStrockSubtractPriceAll" />
    <result column="take_strock_add_num" jdbcType="DECIMAL" property="takeStrockAddNum" />
    <result column="take_strock_add_price_all" jdbcType="DECIMAL" property="takeStrockAddPriceAll" />
    <result column="stro_in_num_buy_price_all" jdbcType="DECIMAL" property="stroInNumBuyPriceAll" />
    <result column="return_supl_buy_price_all" jdbcType="DECIMAL" property="returnSuplBuyPriceAll" />
    <result column="stro_to_dept_buy_price_all" jdbcType="DECIMAL" property="stroToDeptBuyPriceAll" />
    <result column="stro_to_phar_buy_price_all" jdbcType="DECIMAL" property="stroToPharBuyPriceAll" />
    <result column="report_losses_buy_price_all" jdbcType="DECIMAL" property="reportLossesBuyPriceAll" />
    <result column="phar_return_stro_buy_price_all" jdbcType="DECIMAL" property="pharReturnStroBuyPriceAll" />
    <result column="adjust_profit_buy_price_all" jdbcType="DECIMAL" property="adjustProfitBuyPriceAll" />
    <result column="adjust_loss_buy_price_all" jdbcType="DECIMAL" property="adjustLossBuyPriceAll" />
    <result column="take_strock_subtract_buy_price_all" jdbcType="DECIMAL" property="takeStrockSubtractBuyPriceAll" />
    <result column="take_strock_add_buy_price_all" jdbcType="DECIMAL" property="takeStrockAddBuyPriceAll" />
    <result column="out_sales_num" jdbcType="DECIMAL" property="outSalesNum" />
    <result column="out_sales_price_all" jdbcType="DECIMAL" property="outSalesPriceAll" />
    <result column="out_sales_buy_price_all" jdbcType="DECIMAL" property="outSalesBuyPriceAll" />
    <result column="in_sales_buy_price_all" jdbcType="DECIMAL" property="inSalesBuyPriceAll" />
    <result column="in_sales_price_all" jdbcType="DECIMAL" property="inSalesPriceAll" />
    <result column="in_sales_num" jdbcType="DECIMAL" property="inSalesNum" />
    <result column="stro_phar" jdbcType="VARCHAR" property="stroPhar" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
  </resultMap>
  <sql id="Base_Column_List">
    id, hosp_code, biz_id, item_code, item_id, item_name, num, unit_code, curr_unit_code,
    sell_price, buy_price, split_ratio, split_price, split_num, split_unit_code, up_surplus_num,
    surplus_num, up_buy_price_all, buy_price_all, up_sell_price_all, sell_price_all,
    crte_time, new_price, new_split_price, stro_in_num, stro_in_num_price_all, return_supl_num,
    return_supl_price_all, stro_to_dept_num, stro_to_dept_price_all, stro_to_phar_num,
    stro_to_phar_price_all, report_losses_num, report_losses_price_all, phar_return_stro_num,
    phar_return_stro_price_all, adjust_profit_price_all, adjust_loss_price_all, take_strock_subtract_num,
    take_strock_subtract_price_all, take_strock_add_num, take_strock_add_price_all, stro_in_num_buy_price_all,
    return_supl_buy_price_all, stro_to_dept_buy_price_all, stro_to_phar_buy_price_all,
    report_losses_buy_price_all, phar_return_stro_buy_price_all, adjust_profit_buy_price_all,
    adjust_loss_buy_price_all, take_strock_subtract_buy_price_all, take_strock_add_buy_price_all,
    out_sales_num, out_sales_price_all, out_sales_buy_price_all, in_sales_buy_price_all,
    in_sales_price_all, in_sales_num, stro_phar, modify_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from stro_invoicing_monthly
    where id = #{item.id}
  </select>
  <select id="queryAllByDate" resultType="cn.hsa.module.stro.stroinvoicing.dto.StroInvoicingMonthlyDTO">
    SELECT
    itemId,bizId,DATE_FORMAT(crte_time,'%Y-%m') as crteTime,stroPhar,id,hospCode
    from stro_invoicing_monthly where hosp_code = #{item.hospCode} and DATE_FORMAT(crte_time,'%Y-%m') = DATE_FORMAT(#{item.crteTime},'%Y-%m')
    GROUP BY item_id,biz_id,crte_time,stroPhar
  </select>
  <select id="queryRecentlyUpdateTime" resultType="java.sql.Date">
    select DATE_FORMAT(max(modify_time),'%Y-%m-%d') from stro_invoicing_monthly where hosp_code = #{hospCode} and DATE_FORMAT(crte_time,'%Y-%m-%d') &lt; #{date} limit 1;
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from stro_invoicing_monthly
    where id = #{item.id}
  </delete>
  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="cn.hsa.module.stro.stroinvoicing.dto.StroInvoicingMonthlyDTO" useGeneratedKeys="true">
    insert into stro_invoicing_monthly (hosp_code, biz_id, item_code,
      item_id, item_name, num,
      unit_code, curr_unit_code, sell_price,
      buy_price, split_ratio, split_price,
      split_num, split_unit_code, up_surplus_num,
      surplus_num, up_buy_price_all, buy_price_all,
      up_sell_price_all, sell_price_all, crte_time,
      new_price, new_split_price, stro_in_num,
      stro_in_num_price_all, return_supl_num, return_supl_price_all,
      stro_to_dept_num, stro_to_dept_price_all, stro_to_phar_num,
      stro_to_phar_price_all, report_losses_num, report_losses_price_all,
      phar_return_stro_num, phar_return_stro_price_all,
      adjust_profit_price_all, adjust_loss_price_all,
      take_strock_subtract_num, take_strock_subtract_price_all,
      take_strock_add_num, take_strock_add_price_all,
      stro_in_num_buy_price_all, return_supl_buy_price_all,
      stro_to_dept_buy_price_all, stro_to_phar_buy_price_all,
      report_losses_buy_price_all, phar_return_stro_buy_price_all,
      adjust_profit_buy_price_all, adjust_loss_buy_price_all,
      take_strock_subtract_buy_price_all, take_strock_add_buy_price_all,
      out_sales_num, out_sales_price_all, out_sales_buy_price_all,
      in_sales_buy_price_all, in_sales_price_all, in_sales_num,
      stro_phar, modify_time)
    values (#{item.hospCode}, #{item.bizId}, #{item.itemCode},
      #{item.itemId}, #{item.itemName}, #{item.num},
      #{item.unitCode}, #{item.currUnitCode}, #{item.sellPrice},
      #{item.buyPrice}, #{item.splitRatio}, #{item.splitPrice},
      #{item.splitNum}, #{item.splitUnitCode}, #{item.upSurplusNum},
      #{item.surplusNum}, #{item.upBuyPriceAll}, #{item.buyPriceAll},
      #{item.upSellPriceAll}, #{item.sellPriceAll}, #{item.crteTime},
      #{item.newPrice}, #{item.newSplitPrice}, #{item.stroInNum},
      #{item.stroInNumPriceAll}, #{item.returnSuplNum}, #{item.returnSuplPriceAll},
      #{item.stroToDeptNum}, #{item.stroToDeptPriceAll}, #{item.stroToPharNum},
      #{item.stroToPharPriceAll}, #{item.reportLossesNum}, #{item.reportLossesPriceAll},
      #{item.pharReturnStroNum}, #{item.pharReturnStroPriceAll},
      #{item.adjustProfitPriceAll}, #{item.adjustLossPriceAll},
      #{item.takeStrockSubtractNum}, #{item.takeStrockSubtractPriceAll},
      #{item.takeStrockAddNum}, #{item.takeStrockAddPriceAll},
      #{item.stroInNumBuyPriceAll}, #{item.returnSuplBuyPriceAll},
      #{item.stroToDeptBuyPriceAll}, #{item.stroToPharBuyPriceAll},
      #{item.reportLossesBuyPriceAll}, #{item.pharReturnStroBuyPriceAll},
      #{item.adjustProfitBuyPriceAll}, #{item.adjustLossBuyPriceAll},
      #{item.takeStrockSubtractBuyPriceAll}, #{item.takeStrockAddBuyPriceAll},
      #{item.outSalesNum}, #{item.outSalesPriceAll}, #{item.outSalesBuyPriceAll},
      #{item.inSalesBuyPriceAll}, #{item.inSalesPriceAll}, #{item.inSalesNum},
      #{item.stroPhar}, #{item.modifyTime})
  </insert>
  <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="cn.hsa.module.stro.stroinvoicing.dto.StroInvoicingMonthlyDTO" useGeneratedKeys="true">
    insert into stro_invoicing_monthly
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="hospCode != null">
        hosp_code,
      </if>
      <if test="bizId != null">
        biz_id,
      </if>
      <if test="itemCode != null">
        item_code,
      </if>
      <if test="itemId != null">
        item_id,
      </if>
      <if test="itemName != null">
        item_name,
      </if>
      <if test="num != null">
        num,
      </if>
      <if test="unitCode != null">
        unit_code,
      </if>
      <if test="currUnitCode != null">
        curr_unit_code,
      </if>
      <if test="sellPrice != null">
        sell_price,
      </if>
      <if test="buyPrice != null">
        buy_price,
      </if>
      <if test="splitRatio != null">
        split_ratio,
      </if>
      <if test="splitPrice != null">
        split_price,
      </if>
      <if test="splitNum != null">
        split_num,
      </if>
      <if test="splitUnitCode != null">
        split_unit_code,
      </if>
      <if test="upSurplusNum != null">
        up_surplus_num,
      </if>
      <if test="surplusNum != null">
        surplus_num,
      </if>
      <if test="upBuyPriceAll != null">
        up_buy_price_all,
      </if>
      <if test="buyPriceAll != null">
        buy_price_all,
      </if>
      <if test="upSellPriceAll != null">
        up_sell_price_all,
      </if>
      <if test="sellPriceAll != null">
        sell_price_all,
      </if>
      <if test="crteTime != null">
        crte_time,
      </if>
      <if test="newPrice != null">
        new_price,
      </if>
      <if test="newSplitPrice != null">
        new_split_price,
      </if>
      <if test="stroInNum != null">
        stro_in_num,
      </if>
      <if test="stroInNumPriceAll != null">
        stro_in_num_price_all,
      </if>
      <if test="returnSuplNum != null">
        return_supl_num,
      </if>
      <if test="returnSuplPriceAll != null">
        return_supl_price_all,
      </if>
      <if test="stroToDeptNum != null">
        stro_to_dept_num,
      </if>
      <if test="stroToDeptPriceAll != null">
        stro_to_dept_price_all,
      </if>
      <if test="stroToPharNum != null">
        stro_to_phar_num,
      </if>
      <if test="stroToPharPriceAll != null">
        stro_to_phar_price_all,
      </if>
      <if test="reportLossesNum != null">
        report_losses_num,
      </if>
      <if test="reportLossesPriceAll != null">
        report_losses_price_all,
      </if>
      <if test="pharReturnStroNum != null">
        phar_return_stro_num,
      </if>
      <if test="pharReturnStroPriceAll != null">
        phar_return_stro_price_all,
      </if>
      <if test="adjustProfitPriceAll != null">
        adjust_profit_price_all,
      </if>
      <if test="adjustLossPriceAll != null">
        adjust_loss_price_all,
      </if>
      <if test="takeStrockSubtractNum != null">
        take_strock_subtract_num,
      </if>
      <if test="takeStrockSubtractPriceAll != null">
        take_strock_subtract_price_all,
      </if>
      <if test="takeStrockAddNum != null">
        take_strock_add_num,
      </if>
      <if test="takeStrockAddPriceAll != null">
        take_strock_add_price_all,
      </if>
      <if test="stroInNumBuyPriceAll != null">
        stro_in_num_buy_price_all,
      </if>
      <if test="returnSuplBuyPriceAll != null">
        return_supl_buy_price_all,
      </if>
      <if test="stroToDeptBuyPriceAll != null">
        stro_to_dept_buy_price_all,
      </if>
      <if test="stroToPharBuyPriceAll != null">
        stro_to_phar_buy_price_all,
      </if>
      <if test="reportLossesBuyPriceAll != null">
        report_losses_buy_price_all,
      </if>
      <if test="pharReturnStroBuyPriceAll != null">
        phar_return_stro_buy_price_all,
      </if>
      <if test="adjustProfitBuyPriceAll != null">
        adjust_profit_buy_price_all,
      </if>
      <if test="adjustLossBuyPriceAll != null">
        adjust_loss_buy_price_all,
      </if>
      <if test="takeStrockSubtractBuyPriceAll != null">
        take_strock_subtract_buy_price_all,
      </if>
      <if test="takeStrockAddBuyPriceAll != null">
        take_strock_add_buy_price_all,
      </if>
      <if test="outSalesNum != null">
        out_sales_num,
      </if>
      <if test="outSalesPriceAll != null">
        out_sales_price_all,
      </if>
      <if test="outSalesBuyPriceAll != null">
        out_sales_buy_price_all,
      </if>
      <if test="inSalesBuyPriceAll != null">
        in_sales_buy_price_all,
      </if>
      <if test="inSalesPriceAll != null">
        in_sales_price_all,
      </if>
      <if test="inSalesNum != null">
        in_sales_num,
      </if>
      <if test="stroPhar != null">
        stro_phar,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="hospCode != null">
        #{item.hospCode},
      </if>
      <if test="bizId != null">
        #{item.bizId},
      </if>
      <if test="itemCode != null">
        #{item.itemCode},
      </if>
      <if test="itemId != null">
        #{item.itemId},
      </if>
      <if test="itemName != null">
        #{item.itemName},
      </if>
      <if test="num != null">
        #{item.num},
      </if>
      <if test="unitCode != null">
        #{item.unitCode},
      </if>
      <if test="currUnitCode != null">
        #{item.currUnitCode},
      </if>
      <if test="sellPrice != null">
        #{item.sellPrice},
      </if>
      <if test="buyPrice != null">
        #{item.buyPrice},
      </if>
      <if test="splitRatio != null">
        #{item.splitRatio},
      </if>
      <if test="splitPrice != null">
        #{item.splitPrice},
      </if>
      <if test="splitNum != null">
        #{item.splitNum},
      </if>
      <if test="splitUnitCode != null">
        #{item.splitUnitCode},
      </if>
      <if test="upSurplusNum != null">
        #{item.upSurplusNum},
      </if>
      <if test="surplusNum != null">
        #{item.surplusNum},
      </if>
      <if test="upBuyPriceAll != null">
        #{item.upBuyPriceAll},
      </if>
      <if test="buyPriceAll != null">
        #{item.buyPriceAll},
      </if>
      <if test="upSellPriceAll != null">
        #{item.upSellPriceAll},
      </if>
      <if test="sellPriceAll != null">
        #{item.sellPriceAll},
      </if>
      <if test="crteTime != null">
        #{item.crteTime},
      </if>
      <if test="newPrice != null">
        #{item.newPrice},
      </if>
      <if test="newSplitPrice != null">
        #{item.newSplitPrice},
      </if>
      <if test="stroInNum != null">
        #{item.stroInNum},
      </if>
      <if test="stroInNumPriceAll != null">
        #{item.stroInNumPriceAll},
      </if>
      <if test="returnSuplNum != null">
        #{item.returnSuplNum},
      </if>
      <if test="returnSuplPriceAll != null">
        #{item.returnSuplPriceAll},
      </if>
      <if test="stroToDeptNum != null">
        #{item.stroToDeptNum},
      </if>
      <if test="stroToDeptPriceAll != null">
        #{item.stroToDeptPriceAll},
      </if>
      <if test="stroToPharNum != null">
        #{item.stroToPharNum},
      </if>
      <if test="stroToPharPriceAll != null">
        #{item.stroToPharPriceAll},
      </if>
      <if test="reportLossesNum != null">
        #{item.reportLossesNum},
      </if>
      <if test="reportLossesPriceAll != null">
        #{item.reportLossesPriceAll},
      </if>
      <if test="pharReturnStroNum != null">
        #{item.pharReturnStroNum},
      </if>
      <if test="pharReturnStroPriceAll != null">
        #{item.pharReturnStroPriceAll},
      </if>
      <if test="adjustProfitPriceAll != null">
        #{item.adjustProfitPriceAll},
      </if>
      <if test="adjustLossPriceAll != null">
        #{item.adjustLossPriceAll},
      </if>
      <if test="takeStrockSubtractNum != null">
        #{item.takeStrockSubtractNum},
      </if>
      <if test="takeStrockSubtractPriceAll != null">
        #{item.takeStrockSubtractPriceAll},
      </if>
      <if test="takeStrockAddNum != null">
        #{item.takeStrockAddNum},
      </if>
      <if test="takeStrockAddPriceAll != null">
        #{item.takeStrockAddPriceAll},
      </if>
      <if test="stroInNumBuyPriceAll != null">
        #{item.stroInNumBuyPriceAll},
      </if>
      <if test="returnSuplBuyPriceAll != null">
        #{item.returnSuplBuyPriceAll},
      </if>
      <if test="stroToDeptBuyPriceAll != null">
        #{item.stroToDeptBuyPriceAll},
      </if>
      <if test="stroToPharBuyPriceAll != null">
        #{item.stroToPharBuyPriceAll},
      </if>
      <if test="reportLossesBuyPriceAll != null">
        #{item.reportLossesBuyPriceAll},
      </if>
      <if test="pharReturnStroBuyPriceAll != null">
        #{item.pharReturnStroBuyPriceAll},
      </if>
      <if test="adjustProfitBuyPriceAll != null">
        #{item.adjustProfitBuyPriceAll},
      </if>
      <if test="adjustLossBuyPriceAll != null">
        #{item.adjustLossBuyPriceAll},
      </if>
      <if test="takeStrockSubtractBuyPriceAll != null">
        #{item.takeStrockSubtractBuyPriceAll},
      </if>
      <if test="takeStrockAddBuyPriceAll != null">
        #{item.takeStrockAddBuyPriceAll},
      </if>
      <if test="outSalesNum != null">
        #{item.outSalesNum},
      </if>
      <if test="outSalesPriceAll != null">
        #{item.outSalesPriceAll},
      </if>
      <if test="outSalesBuyPriceAll != null">
        #{item.outSalesBuyPriceAll},
      </if>
      <if test="inSalesBuyPriceAll != null">
        #{item.inSalesBuyPriceAll},
      </if>
      <if test="inSalesPriceAll != null">
        #{item.inSalesPriceAll},
      </if>
      <if test="inSalesNum != null">
        #{item.inSalesNum},
      </if>
      <if test="stroPhar != null">
        #{item.stroPhar},
      </if>
      <if test="modifyTime != null">
        #{item.modifyTime},
      </if>
    </trim>
  </insert>
  <insert id="insertBatch">
   insert into stro_invoicing_monthly (id,hosp_code, biz_id, item_code,
      item_id, item_name, num,
      unit_code, curr_unit_code, sell_price,
      buy_price, split_ratio, split_price,
      split_num, split_unit_code, up_surplus_num,
      surplus_num, up_buy_price_all, buy_price_all,
      up_sell_price_all, sell_price_all, crte_time,
      new_price, new_split_price, stro_in_num,
      stro_in_num_price_all, return_supl_num, return_supl_price_all,
      stro_to_dept_num, stro_to_dept_price_all, stro_to_phar_num,
      stro_to_phar_price_all, report_losses_num, report_losses_price_all,
      phar_return_stro_num, phar_return_stro_price_all,
      adjust_profit_price_all, adjust_loss_price_all,
      take_strock_subtract_num, take_strock_subtract_price_all,
      take_strock_add_num, take_strock_add_price_all,
      stro_in_num_buy_price_all, return_supl_buy_price_all,
      stro_to_dept_buy_price_all, stro_to_phar_buy_price_all,
      report_losses_buy_price_all, phar_return_stro_buy_price_all,
      adjust_profit_buy_price_all, adjust_loss_buy_price_all,
      take_strock_subtract_buy_price_all, take_strock_add_buy_price_all,
      out_sales_num, out_sales_price_all, out_sales_buy_price_all,
      in_sales_buy_price_all, in_sales_price_all, in_sales_num,
      stro_phar, modify_time)
    values 
    <foreach collection="stroInvoicingMonthlyDTOS" item="item" open="(" separator="," close=")">
      #{item.monthlyId},#{item.hospCode}, #{item.bizId}, #{item.itemCode},
      #{item.itemId}, #{item.itemName}, #{item.num},
      #{item.unitCode}, #{item.currUnitCode}, #{item.sellPrice},
      #{item.buyPrice}, #{item.splitRatio}, #{item.splitPrice},
      #{item.splitNum}, #{item.splitUnitCode}, #{item.upSurplusNum},
      #{item.surplusNum}, #{item.upBuyPriceAll}, #{item.buyPriceAll},
      #{item.upSellPriceAll}, #{item.sellPriceAll}, DATE_FORMAT(#{item.crteTime},'%Y-%m-%d'),
      #{item.newPrice}, #{item.newSplitPrice}, #{item.stroInNum},
      #{item.stroInNumPriceAll}, #{item.returnSuplNum}, #{item.returnSuplPriceAll},
      #{item.stroToDeptNum}, #{item.stroToDeptPriceAll}, #{item.stroToPharNum},
      #{item.stroToPharPriceAll}, #{item.reportLossesNum}, #{item.reportLossesPriceAll},
      #{item.pharReturnStroNum}, #{item.pharReturnStroPriceAll},
      #{item.adjustProfitPriceAll}, #{item.adjustLossPriceAll},
      #{item.takeStrockSubtractNum}, #{item.takeStrockSubtractPriceAll},
      #{item.takeStrockAddNum}, #{item.takeStrockAddPriceAll},
      #{item.stroInNumBuyPriceAll}, #{item.returnSuplBuyPriceAll},
      #{item.stroToDeptBuyPriceAll}, #{item.stroToPharBuyPriceAll},
      #{item.reportLossesBuyPriceAll}, #{item.pharReturnStroBuyPriceAll},
      #{item.adjustProfitBuyPriceAll}, #{item.adjustLossBuyPriceAll},
      #{item.takeStrockSubtractBuyPriceAll}, #{item.takeStrockAddBuyPriceAll},
      #{item.outSalesNum}, #{item.outSalesPriceAll}, #{item.outSalesBuyPriceAll},
      #{item.inSalesBuyPriceAll}, #{item.inSalesPriceAll}, #{item.inSalesNum},
      #{item.stroPhar}, #{item.modifyTime}
    </foreach>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.hsa.module.stro.stroinvoicing.dto.StroInvoicingMonthlyDTO">
    update stro_invoicing_monthly
    <set>
      <if test="hospCode != null">
        hosp_code = #{item.hospCode},
      </if>
      <if test="bizId != null">
        biz_id = #{item.bizId},
      </if>
      <if test="itemCode != null">
        item_code = #{item.itemCode},
      </if>
      <if test="itemId != null">
        item_id = #{item.itemId},
      </if>
      <if test="itemName != null">
        item_name = #{item.itemName},
      </if>
      <if test="num != null">
        num = #{item.num},
      </if>
      <if test="unitCode != null">
        unit_code = #{item.unitCode},
      </if>
      <if test="currUnitCode != null">
        curr_unit_code = #{item.currUnitCode},
      </if>
      <if test="sellPrice != null">
        sell_price = #{item.sellPrice},
      </if>
      <if test="buyPrice != null">
        buy_price = #{item.buyPrice},
      </if>
      <if test="splitRatio != null">
        split_ratio = #{item.splitRatio},
      </if>
      <if test="splitPrice != null">
        split_price = #{item.splitPrice},
      </if>
      <if test="splitNum != null">
        split_num = #{item.splitNum},
      </if>
      <if test="splitUnitCode != null">
        split_unit_code = #{item.splitUnitCode},
      </if>
      <if test="upSurplusNum != null">
        up_surplus_num = #{item.upSurplusNum},
      </if>
      <if test="surplusNum != null">
        surplus_num = #{item.surplusNum},
      </if>
      <if test="upBuyPriceAll != null">
        up_buy_price_all = #{item.upBuyPriceAll},
      </if>
      <if test="buyPriceAll != null">
        buy_price_all = #{item.buyPriceAll},
      </if>
      <if test="upSellPriceAll != null">
        up_sell_price_all = #{item.upSellPriceAll},
      </if>
      <if test="sellPriceAll != null">
        sell_price_all = #{item.sellPriceAll},
      </if>
      <if test="crteTime != null">
        crte_time = #{item.crteTime},
      </if>
      <if test="newPrice != null">
        new_price = #{item.newPrice},
      </if>
      <if test="newSplitPrice != null">
        new_split_price = #{item.newSplitPrice},
      </if>
      <if test="stroInNum != null">
        stro_in_num = #{item.stroInNum},
      </if>
      <if test="stroInNumPriceAll != null">
        stro_in_num_price_all = #{item.stroInNumPriceAll},
      </if>
      <if test="returnSuplNum != null">
        return_supl_num = #{item.returnSuplNum},
      </if>
      <if test="returnSuplPriceAll != null">
        return_supl_price_all = #{item.returnSuplPriceAll},
      </if>
      <if test="stroToDeptNum != null">
        stro_to_dept_num = #{item.stroToDeptNum},
      </if>
      <if test="stroToDeptPriceAll != null">
        stro_to_dept_price_all = #{item.stroToDeptPriceAll},
      </if>
      <if test="stroToPharNum != null">
        stro_to_phar_num = #{item.stroToPharNum},
      </if>
      <if test="stroToPharPriceAll != null">
        stro_to_phar_price_all = #{item.stroToPharPriceAll},
      </if>
      <if test="reportLossesNum != null">
        report_losses_num = #{item.reportLossesNum},
      </if>
      <if test="reportLossesPriceAll != null">
        report_losses_price_all = #{item.reportLossesPriceAll},
      </if>
      <if test="pharReturnStroNum != null">
        phar_return_stro_num = #{item.pharReturnStroNum},
      </if>
      <if test="pharReturnStroPriceAll != null">
        phar_return_stro_price_all = #{item.pharReturnStroPriceAll},
      </if>
      <if test="adjustProfitPriceAll != null">
        adjust_profit_price_all = #{item.adjustProfitPriceAll},
      </if>
      <if test="adjustLossPriceAll != null">
        adjust_loss_price_all = #{item.adjustLossPriceAll},
      </if>
      <if test="takeStrockSubtractNum != null">
        take_strock_subtract_num = #{item.takeStrockSubtractNum},
      </if>
      <if test="takeStrockSubtractPriceAll != null">
        take_strock_subtract_price_all = #{item.takeStrockSubtractPriceAll},
      </if>
      <if test="takeStrockAddNum != null">
        take_strock_add_num = #{item.takeStrockAddNum},
      </if>
      <if test="takeStrockAddPriceAll != null">
        take_strock_add_price_all = #{item.takeStrockAddPriceAll},
      </if>
      <if test="stroInNumBuyPriceAll != null">
        stro_in_num_buy_price_all = #{item.stroInNumBuyPriceAll},
      </if>
      <if test="returnSuplBuyPriceAll != null">
        return_supl_buy_price_all = #{item.returnSuplBuyPriceAll},
      </if>
      <if test="stroToDeptBuyPriceAll != null">
        stro_to_dept_buy_price_all = #{item.stroToDeptBuyPriceAll},
      </if>
      <if test="stroToPharBuyPriceAll != null">
        stro_to_phar_buy_price_all = #{item.stroToPharBuyPriceAll},
      </if>
      <if test="reportLossesBuyPriceAll != null">
        report_losses_buy_price_all = #{item.reportLossesBuyPriceAll},
      </if>
      <if test="pharReturnStroBuyPriceAll != null">
        phar_return_stro_buy_price_all = #{item.pharReturnStroBuyPriceAll},
      </if>
      <if test="adjustProfitBuyPriceAll != null">
        adjust_profit_buy_price_all = #{item.adjustProfitBuyPriceAll},
      </if>
      <if test="adjustLossBuyPriceAll != null">
        adjust_loss_buy_price_all = #{item.adjustLossBuyPriceAll},
      </if>
      <if test="takeStrockSubtractBuyPriceAll != null">
        take_strock_subtract_buy_price_all = #{item.takeStrockSubtractBuyPriceAll},
      </if>
      <if test="takeStrockAddBuyPriceAll != null">
        take_strock_add_buy_price_all = #{item.takeStrockAddBuyPriceAll},
      </if>
      <if test="outSalesNum != null">
        out_sales_num = #{item.outSalesNum},
      </if>
      <if test="outSalesPriceAll != null">
        out_sales_price_all = #{item.outSalesPriceAll},
      </if>
      <if test="outSalesBuyPriceAll != null">
        out_sales_buy_price_all = #{item.outSalesBuyPriceAll},
      </if>
      <if test="inSalesBuyPriceAll != null">
        in_sales_buy_price_all = #{item.inSalesBuyPriceAll},
      </if>
      <if test="inSalesPriceAll != null">
        in_sales_price_all = #{item.inSalesPriceAll},
      </if>
      <if test="inSalesNum != null">
        in_sales_num = #{item.inSalesNum},
      </if>
      <if test="stroPhar != null">
        stro_phar = #{item.stroPhar},
      </if>
      <if test="modifyTime != null">
        modify_time = #{item.modifyTime},
      </if>
    </set>
    where id = #{item.id}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.hsa.module.stro.stroinvoicing.dto.StroInvoicingMonthlyDTO">
    update stro_invoicing_monthly
    set hosp_code = #{item.hospCode},
      biz_id = #{item.bizId},
      item_code = #{item.itemCode},
      item_id = #{item.itemId},
      item_name = #{item.itemName},
      num = #{item.num},
      unit_code = #{item.unitCode},
      curr_unit_code = #{item.currUnitCode},
      sell_price = #{item.sellPrice},
      buy_price = #{item.buyPrice},
      split_ratio = #{item.splitRatio},
      split_price = #{item.splitPrice},
      split_num = #{item.splitNum},
      split_unit_code = #{item.splitUnitCode},
      up_surplus_num = #{item.upSurplusNum},
      surplus_num = #{item.surplusNum},
      up_buy_price_all = #{item.upBuyPriceAll},
      buy_price_all = #{item.buyPriceAll},
      up_sell_price_all = #{item.upSellPriceAll},
      sell_price_all = #{item.sellPriceAll},
      crte_time = #{item.crteTime},
      new_price = #{item.newPrice},
      new_split_price = #{item.newSplitPrice},
      stro_in_num = #{item.stroInNum},
      stro_in_num_price_all = #{item.stroInNumPriceAll},
      return_supl_num = #{item.returnSuplNum},
      return_supl_price_all = #{item.returnSuplPriceAll},
      stro_to_dept_num = #{item.stroToDeptNum},
      stro_to_dept_price_all = #{item.stroToDeptPriceAll},
      stro_to_phar_num = #{item.stroToPharNum},
      stro_to_phar_price_all = #{item.stroToPharPriceAll},
      report_losses_num = #{item.reportLossesNum},
      report_losses_price_all = #{item.reportLossesPriceAll},
      phar_return_stro_num = #{item.pharReturnStroNum},
      phar_return_stro_price_all = #{item.pharReturnStroPriceAll},
      adjust_profit_price_all = #{item.adjustProfitPriceAll},
      adjust_loss_price_all = #{item.adjustLossPriceAll},
      take_strock_subtract_num = #{item.takeStrockSubtractNum},
      take_strock_subtract_price_all = #{item.takeStrockSubtractPriceAll},
      take_strock_add_num = #{item.takeStrockAddNum},
      take_strock_add_price_all = #{item.takeStrockAddPriceAll},
      stro_in_num_buy_price_all = #{item.stroInNumBuyPriceAll},
      return_supl_buy_price_all = #{item.returnSuplBuyPriceAll},
      stro_to_dept_buy_price_all = #{item.stroToDeptBuyPriceAll},
      stro_to_phar_buy_price_all = #{item.stroToPharBuyPriceAll},
      report_losses_buy_price_all = #{item.reportLossesBuyPriceAll},
      phar_return_stro_buy_price_all = #{item.pharReturnStroBuyPriceAll},
      adjust_profit_buy_price_all = #{item.adjustProfitBuyPriceAll},
      adjust_loss_buy_price_all = #{item.adjustLossBuyPriceAll},
      take_strock_subtract_buy_price_all = #{item.takeStrockSubtractBuyPriceAll},
      take_strock_add_buy_price_all = #{item.takeStrockAddBuyPriceAll},
      out_sales_num = #{item.outSalesNum},
      out_sales_price_all = #{item.outSalesPriceAll},
      out_sales_buy_price_all = #{item.outSalesBuyPriceAll},
      in_sales_buy_price_all = #{item.inSalesBuyPriceAll},
      in_sales_price_all = #{item.inSalesPriceAll},
      in_sales_num = #{item.inSalesNum},
      stro_phar = #{item.stroPhar},
      modify_time = #{item.modifyTime}
    where id = #{item.id}
  </update>
    <!--回写主表-->
    <update id="updateByDate">
  update stro_invoicing_monthly a , (select id,hosp_code, biz_id, item_code, item_id, item_name, sum(num) as num,
        unit_code, curr_unit_code, sell_price, buy_price, split_ratio, split_price, sum(split_num) as splitNum,
        split_unit_code,sum(up_surplus_num) as upSurplusNum,sum(surplus_num) as surplusNum,
        sum(up_buy_price_all) as upBuyPriceAll,sum(buy_price_all) as buyPriceAll,
        sum(up_sell_price_all) as upSellPriceAll,sum(sell_price_all) as sellPriceAll, crte_time,
        new_price, new_split_price,sum(stro_in_num) as stroInNum,sum(stro_in_num_price_all) as stroInNumPriceAll,
        sum(return_supl_num) as returnSuplNum,sum(return_supl_price_all) as returnSuplPriceAll,
        sum(stro_to_dept_num) as stroToDeptNum,sum(stro_to_dept_price_all) as stroToDeptPriceAll,
        sum(stro_to_phar_num) as stroToPharNum,sum(stro_to_phar_price_all) as stroToPharPriceAll,
        sum(report_losses_num) as reportLossesNum,sum(report_losses_price_all) as reportLossesPriceAll,
        sum(phar_return_stro_num) as pharReturnStroNum,sum(phar_return_stro_price_all) as pharReturnStroPriceAll,
        sum(adjust_profit_price_all) as adjustProfitPriceAll,sum(adjust_loss_price_all) as adjustLossPriceAll,
        sum(take_strock_subtract_num) as takeStrockSubtractNum,sum(take_strock_subtract_price_all) as takeStrockSubtractPriceAll,
        sum(take_strock_add_num) as takeStrockAddNum,sum(take_strock_add_price_all) as takeStrockAddPriceAll,
        sum(stro_in_num_buy_price_all) as stroInNumBuyPriceAll,sum(return_supl_buy_price_all) as returnSuplBuyPriceAll,
        sum(stro_to_dept_buy_price_all) as stroToDeptBuyPriceAll,sum(stro_to_phar_buy_price_all) as stroToPharBuyPriceAll,
        sum(report_losses_buy_price_all) as reportLossesBuyPriceAll,
        sum(phar_return_stro_buy_price_all) as pharReturnStroBuyPriceAll,
        sum(adjust_profit_buy_price_all) as adjustProfitBuyPriceAll,
        sum(adjust_loss_buy_price_all) as adjustLossBuyPriceAll,
        sum(take_strock_subtract_buy_price_all) AS takeStrockSubtractBuyPriceAll,
        sum(take_strock_add_buy_price_all) as takeStrockAddBuyPriceAll,
        sum(out_sales_num) as outSalesNum,sum(out_sales_price_all) as outSalesPriceAll,
        sum(out_sales_buy_price_all) as outSalesBuyPriceAll,sum(in_sales_buy_price_all) as inSalesBuyPriceAll,
        sum(in_sales_price_all) as inSalesPriceAll,sum(in_sales_num) as inSalesNum,monthly_id
  from stro_invoicing_monthly_detail where date(crte_time) = #{date} GROUP BY monthly_id)b
        set
          a.num = b.num,
          a.split_num = b.splitNum,
          a.up_surplus_num = b.upSurplusNum,
          a.surplus_num = b.surplusNum,
          a.up_buy_price_all = b.upBuyPriceAll,
          a.buy_price_all = b.buyPriceAll,
          a.up_sell_price_all = b.upSellPriceAll,
          a.sell_price_all = b.sellPriceAll,
          a.stro_in_num = b.stroInNum,
          a.stro_in_num_price_all = b.stroInNumPriceAll,
          a.return_supl_num = b.returnSuplNum,
          a.return_supl_price_all = b.returnSuplPriceAll,
          a.stro_to_dept_num = b.stroToDeptNum,
          a.stro_to_dept_price_all = b.stroToDeptPriceAll,
          a.stro_to_phar_num = b.stroToPharNum,
          a.stro_to_phar_price_all = b.stroToPharPriceAll,
          a.report_losses_num = b.reportLossesNum,
          a.report_losses_price_all = b.reportLossesPriceAll,
          a.phar_return_stro_num = b.pharReturnStroNum,
          a.phar_return_stro_price_all = b.pharReturnStroPriceAll,
          a.adjust_profit_price_all = b.adjustProfitPriceAll,
          a.adjust_loss_price_all = b.adjustLossPriceAll,
          a.take_strock_subtract_num = b.takeStrockSubtractNum,
          a.take_strock_subtract_price_all = b.takeStrockSubtractPriceAll,
          a.take_strock_add_num = b.takeStrockAddNum,
          a.take_strock_add_price_all = b.takeStrockAddPriceAll,
          a.stro_in_num_buy_price_all = b.stroInNumBuyPriceAll,
          a.return_supl_buy_price_all = b.returnSuplBuyPriceAll,
          a.stro_to_dept_buy_price_all = b.stroToDeptBuyPriceAll,
          a.stro_to_phar_buy_price_all = b.stroToPharBuyPriceAll,
          a.report_losses_buy_price_all = b.reportLossesBuyPriceAll,
          a.phar_return_stro_buy_price_all = b.pharReturnStroBuyPriceAll,
          a.adjust_profit_buy_price_all = b.adjustProfitBuyPriceAll,
          a.adjust_loss_buy_price_all = b.adjustLossBuyPriceAll,
          a.take_strock_subtract_buy_price_all = b.takeStrockSubtractBuyPriceAll,
          a.take_strock_add_buy_price_all = b.takeStrockAddBuyPriceAll,
          a.out_sales_num = b.outSalesNum,
          a.out_sales_price_all = b.outSalesPriceAll,
          a.out_sales_buy_price_all = b.outSalesBuyPriceAll,
          a.in_sales_buy_price_all = b.inSalesBuyPriceAll,
          a.in_sales_price_all = b.inSalesPriceAll,
          a.in_sales_num = b.inSalesNum,
          a.modify_time = now()
          where a.id = b.monthly_id and DATE_FORMAT(a.crte_time,'%Y-%m') = DATE_FORMAT(#{date},'%Y-%m') and a.hosp_code = #{hospCode}
    </update>
</mapper>